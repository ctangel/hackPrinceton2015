<!doctype HTML>
<hmtl>
    <head>
        <title> HackPrinceton2015</title>
        <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <!--<script src="search.js"></script>-->
        <script type="text/javascript">
            //<![CDATA[ 
            window.onload=function(){
            // find template and compile it
            var templateSource = document.getElementById('results-template').innerHTML,
                template = Handlebars.compile(templateSource),
                resultsPlaceholder = document.getElementById('results');

            var fetchRelatedArtists = function (artistId, callback) {
                $.ajax({
                    url: 'https://api.spotify.com/v1/artists/' + artistId + '/related-artists',
                    success: function (response) {
                        callback(response);
                    }
                });
            };
                
            var fetchRelatedPlaylists = function (playlistId, callback) {
                $.ajax({
                    url: 'https://api.spotify.com/v1/users/' +  + '/playlists/' + playlistId,
                    success: function (response) {
                        callback(response);
                    }
                });
            };

            var searchArtist = function (query, callback) {
                $.ajax({
                    url: 'https://api.spotify.com/v1/search',
                    data: {
                        q: query,
                        type: 'artist'
                    },
                    success: function (response) {
                        var item = response.artists.items[0];
                        callback(item.id, item.name);
                    }
                });
            };
                
            var searchPlaylist = function (query, callback) {
                $.ajax({
                    url: 'https://api.spotify.com/v1/search',
                    data: {
                        q: query,
                        type: 'playlist'
                    },
                    success: function (response) {
                        var item = response.playlist.items[0];
                        callback(item.id, item.name, item.href);
                    }
                });
            };
                
                

            document.getElementById('search-form-for-artists').addEventListener('submit', function (e) {
                e.preventDefault();
                var artistName = document.getElementById('query').value;
                
                searchArtist(artistName, function(id, foundName) {
                    fetchRelatedArtists(id, function(relatedArtists) {
                        relatedArtists.artistName = foundName;
                        resultsPlaceholder.innerHTML = template(relatedArtists);
                    });
                });
                
                searchPlaylist(playlistName, function(id, foundName) {
                    fetchRelatedPlaylists(id, function(relatedArtists) {
                        relatedArtists.playlistName = foundName;
                        resultsPlaceholder.innerHTML = template(relatedArtists);
                    });
                });
            }, false);
            }//]]>  

        </script>
    </head>
    
    <body>
        <header>
            <h1> HackPrinceton2015 </h1>
        </header>
        
        <section class="container">
            <form id="search-form-for-artists">
                <input type="text" id="query" value="" placeholder="Type an artist's name" />
                <input type="submit" id="search" value="Search" />
                <div id="results"></div>
            </form>
        </section>
        <section class="container">
            <form id="search-form">
                <input type="text" id="query" value="" placeholder="Type an artist's name" />
                <input type="submit" id="search" value="Search" />
                <div id="results"></div>
            </form>
        </section>
        
        <script id="results-template" type="text/x-handlebars-template">
            <h2>This is a list of <strong>{{artistName}}</strong>'s related artists</h2>
            {{#each artists}}
            <div class="media">
                <div style="background-image:url({{images.1.url}})" data-album-id="{{id}}" class="media-object cover"></div>
                <div class="media-body">
                <h4 class="media-heading">{{name}}</h4>
                </div>
            </div>
            {{/each}}
        </script>
        
        <script id="playlistTemplate" type="text/x-handlebars-template">
            <h2>This is a list of <strong>{{playlistName}}</strong>'s related playlists</h2>
            {{#each playlists}}
            <div class="media">
                <!--<div style="background-image:url({{images.1.url}})" data-playlist-id="{{id}}" class="media-object cover"></div>-->
                <div class="media-body">
                <h4 class="media-heading">{{href}}</h4>
                </div>
            </div>
            {{/each}}
        </script>
        
    </body>
</hmtl>